(function(t){"use strict";function e(){function e(t){for(var e,n=Array(t.byteLength),i=t.BYTES_PER_ELEMENT,s=0,r=n.length;r>s;++s)e=8*(s%i),n[s]=(t[0|s/i]&255<<e)>>>e;return n.__view=t,n}function n(n,i,u,l){var c,h,f,p,v;if(Array.isArray(i))if(i.__view)if(u===t&&(u=0),l===t&&(l=i.length-u),f=n.bytes,n.type===r)c=i.__view.slice(0|u/f,0|(u+l)/f);else{for(h=i.slice(u,u+l),c=Array(0|h.length/f),p=0,v=c.length;v>p;++p)c[p]=0;for(p=0,v=h.length;v>p;++p)c[0|p/f]+=(255&h[p])<<8*(p%f)}else c=i.slice();else c="number"==typeof i&&i>0?Array(0|i):[];if(n.type!==r)for(p=0,v=c.length;v>p;++p)c[p]=65535&(+c[p]||0);else for(p=0,v=c.length;v>p;++p)c[p]=c[p]||0;if(n.type===s)for(p=0,v=c.length;v>p;++p)c[p]&1<<8*f-1&&(c[p]-=1<<8*f);return c.__klass=n,c.constructor=window[n.name],c.set=a,c.subarray=o,c.BYTES_PER_ELEMENT=n.bytes,c.byteLength=n.bytes*c.length,c.byteOffset=u||0,Object.defineProperty(c,"buffer",{get:function(){return new e(this)}}),c}var i=0,s=1,r=2,a=function(e,n){n===t&&(n=0);var i,s=Math.min(this.length-n,e.length);for(i=0;s>i;++i)this[n+i]=e[i]},o=function(e,n){return n===t&&(n=this.length),new this.constructor(this.slice(e,n))};[["Int8Array",1,s],["Uint8Array",1,i],["Int16Array",2,s],["Uint16Array",2,i],["Int32Array",4,s],["Uint32Array",4,i],["Float32Array",4,r],["Float64Array",8,r]].forEach(function(t){var e=t[0],i={bytes:t[1],type:t[2],name:e};window[e]=function(t,e,s){return n.call(this,i,t,e,s)}})}"undefined"==typeof Float32Array&&e();var n=function(){return _.apply(null,arguments)},i=Array.prototype.slice,s=0,r=1,a=2,o=3,u=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],l=[32,64,128,256],c="13.08.03",h=null,f={},p={},v="undefined"!=typeof module&&module.exports?"node":"undefined"!=typeof window?"browser":"unknown",m="browser"===v&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),d=!1,g=120,_=function(){var e,n,s=i.call(arguments),r=s[0];switch(typeof r){case"string":f[r]?e=new f[r](s.slice(1)):p[r]?e=p[r](s.slice(1)):(n=/^(.+?)(?:\.(ar|kr))?$/.exec(r),n&&(r=n[1],f[r]?e=new f[r](s.slice(1)):p[r]&&(e=p[r](s.slice(1))),e&&n[2]&&e[n[2]]()));break;case"number":e=new j(s);break;case"boolean":e=new D(s);break;case"function":e=new L(s);break;case"object":if(null!==r){if(r instanceof T)return r;if(r.context instanceof T)return r.context;A(r)?e=new I(s):w(r)&&(e=new E(s))}}e===t&&(e=new R(s.slice(1)),console.warn('T("'+r+'") is not defined.'));var a=e._;return a.originkey=r,a.meta=y(e),a.emit("init"),e},y=function(t){for(var e,n,i=t._.meta,s=t;null!==s&&s.constructor!==Object;){e=Object.getOwnPropertyNames(s);for(var r=0,a=e.length;a>r;++r)i[e[r]]||(/^(constructor$|process$|_)/.test(e[r])?i[e[r]]="ignore":(n=Object.getOwnPropertyDescriptor(s,e[r]),"function"==typeof n.value?i[e[r]]="function":(n.get||n.set)&&(i[e[r]]="property")));s=Object.getPrototypeOf(s)}return i};Object.defineProperties(n,{version:{value:c},envtype:{value:v},envmobile:{value:m},env:{get:function(){return h.impl.env}},samplerate:{get:function(){return h.samplerate}},channels:{get:function(){return h.channels}},cellsize:{get:function(){return h.cellsize}},currentTime:{get:function(){return h.currentTime}},isPlaying:{get:function(){return h.status===r}},isRecording:{get:function(){return h.status===o}},amp:{set:function(t){"number"==typeof t&&(h.amp=t)},get:function(){return h.amp}},bpm:{set:function(t){"number"==typeof t&&t>=5&&300>=t&&(g=t)},get:function(){return g}}}),n.bind=function(t,e){return h.bind(t,e),n},n.setup=function(t){return h.setup(t),n},n.play=function(){return h.play(),n},n.pause=function(){return h.pause(),n},n.reset=function(){return h.reset(),h.events.emit("reset"),n},n.on=n.addListener=function(t,e){return h.on(t,e),n},n.once=function(t,e){return h.once(t,e),n},n.off=n.removeListener=function(t,e){return h.off(t,e),n},n.removeAllListeners=function(t){return h.removeAllListeners(t),n},n.listeners=function(t){return h.listeners(t)},n.rec=function(){return h.rec.apply(h,arguments)},n.timevalue=function(){var t=function(t){var e,n=g;return(e=/^bpm(\d+(?:\.\d+)?)/i.exec(t))&&(n=Math.max(5,Math.min(300,+(e[1]||0)))),n};return function(e){var i,s,r;if(i=/^(\d+(?:\.\d+)?)Hz$/i.exec(e))return 0===+i[1]?0:1e3/+i[1];if(i=/L(\d+)?(\.*)$/i.exec(e))return s=1e3*60/t(e)*(4/(i[1]||4)),s*=[1,1.5,1.75,1.875][(i[2]||"").length]||1;if(i=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(e))switch(i[2]){case"min":return 1e3*60*+(i[1]||0);case"sec":return 1e3*+(i[1]||0);case"m":return+(i[1]||0)}return(i=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(e))?(r=3600*(i[1]||0)+60*(i[2]||0)+(i[3]||0),r=1e3*r+(0|((i[4]||"")+"00").substr(0,3))):(i=/(\d+)\.(\d+)\.(\d+)$/i.exec(e))?(r=480*(4*i[1]+ +i[2])+ +i[3],1e3*60/t(e)*(r/480)):(i=/(\d+)ticks$/i.exec(e))?1e3*60/t(e)*(i[1]/480):(i=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(e))?1e3*i[1]/(i[2]||n.samplerate):0}}();var b=n.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:s,PLAYING_STATE:r,UNSCHEDULED_STATE:a,SCHEDULED_STATE:o},w=b.isArray=Array.isArray,A=b.isDictionary=function(t){return"object"==typeof t&&t.constructor===Object};b.nop=function(){return this},b.isSignalArray=function(t){return t instanceof b.SignalArray?!0:Array.isArray(t)&&t.__klass&&2===t.__klass.type?!0:!1},b.extend=function(t,e){function n(){this.constructor=t}e=e||T;for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},b.constructorof=function(t,e){for(var n=t&&t.prototype;n;){if(n===e.prototype)return!0;n=Object.getPrototypeOf(n)}return!1},b.register=function(t,e){b.constructorof(e,T)?f[t]=e:p[t]=e},b.alias=function(t,e){f[e]?f[t]=f[e]:p[e]&&(p[t]=p[e])},b.getClass=function(t){return f[t]},b.pointer=function(t,e,n){return e=t.byteOffset+e*t.constructor.BYTES_PER_ELEMENT,"number"==typeof n?new t.constructor(t.buffer,e,n):new t.constructor(t.buffer,e)},b.nextTick=function(t){return h.nextTick(t),n},b.fixAR=function(t){t._.ar=!0,t._.aronly=!0},b.fixKR=function(t){t._.ar=!1,t._.kronly=!0},b.changeWithValue=function(){var t=this._,e=t.value*t.mul+t.add;isNaN(e)&&(e=0);for(var n=this.cells[0],i=0,s=n.length;s>i;++i)n[i]=e},b.changeWithValue.unremovable=!0,b.clone=function(t){var e=new t.constructor([]);return e._.ar=t._.ar,e._.mul=t._.mul,e._.add=t._.add,e._.bypassed=t._.bypassed,e},b.timer=function(){var t=function(t){return function(){-1===h.timers.indexOf(t)&&(h.timers.push(t),h.events.emit("addObject"),t._.emit("start"),b.buddies_start(t))}},e=function(t){return function(){var e=h.timers.indexOf(t);-1!==e&&(h.timers.splice(e,1),t._.emit("stop"),h.events.emit("removeObject"),b.buddies_stop(t))}};return function(n){var i=t(n),s=e(n);return n.nodeType=T.TIMER,n.start=function(){return h.nextTick(i),n},n.stop=function(){return h.nextTick(s),n},n}}(),b.listener=function(){var t=function(t){return function(){-1===h.listeners.indexOf(t)&&(h.listeners.push(t),h.events.emit("addObject"),t._.emit("listen"),b.buddies_start(t))}},e=function(t){return function(){var e=h.listeners.indexOf(t);-1!==e&&(h.listeners.splice(e,1),t._.emit("unlisten"),h.events.emit("removeObject"),b.buddies_stop(t))}};return function(n){var i=t(n),s=e(n);return n.nodeType=T.LISTENER,n.listen=function(){return arguments.length&&n.append.apply(n,arguments),n.nodes.length&&h.nextTick(i),n},n.unlisten=function(){return arguments.length&&n.remove.apply(n,arguments),n.nodes.length||h.nextTick(s),n},n}}(),b.make_onended=function(t,e){return function(){if(t.playbackState=s,"number"==typeof e)for(var n=t.cells[0],i=t.cells[1],r=t.cells[2],a=0,o=i.length;o>a;++a)n[0]=i[a]=r[a]=e;t._.emit("ended")}},b.inputSignalAR=function(t){var e,n,i,s,a,o,u=t.cells[0],l=t.cells[1],c=t.cells[2],h=t.nodes,f=h.length,p=u.length,v=t.tickID;if(2===t.numChannels){if(i=!0,0!==f){for(e=0;f>e;++e)if(h[e].playbackState===r){h[e].process(v),l.set(h[e].cells[1]),c.set(h[e].cells[2]),i=!1,++e;break}for(;f>e;++e)if(h[e].playbackState===r)for(h[e].process(v),a=h[e].cells[1],o=h[e].cells[2],n=p;n;)n-=8,l[n]+=a[n],c[n]+=o[n],l[n+1]+=a[n+1],c[n+1]+=o[n+1],l[n+2]+=a[n+2],c[n+2]+=o[n+2],l[n+3]+=a[n+3],c[n+3]+=o[n+3],l[n+4]+=a[n+4],c[n+4]+=o[n+4],l[n+5]+=a[n+5],c[n+5]+=o[n+5],l[n+6]+=a[n+6],c[n+6]+=o[n+6],l[n+7]+=a[n+7],c[n+7]+=o[n+7]}i&&(l.set(b.emptycell),c.set(b.emptycell))}else{if(i=!0,0!==f){for(e=0;f>e;++e)if(h[e].playbackState===r){h[e].process(v),u.set(h[e].cells[0]),i=!1,++e;break}for(;f>e;++e)if(h[e].playbackState===r)for(s=h[e].process(v).cells[0],n=p;n;)n-=8,u[n]+=s[n],u[n+1]+=s[n+1],u[n+2]+=s[n+2],u[n+3]+=s[n+3],u[n+4]+=s[n+4],u[n+5]+=s[n+5],u[n+6]+=s[n+6],u[n+7]+=s[n+7]}i&&u.set(b.emptycell)}},b.inputSignalKR=function(t){var e,n=t.nodes,i=n.length,s=t.tickID,a=0;for(e=0;i>e;++e)n[e].playbackState===r&&(a+=n[e].process(s).cells[0][0]);return a},b.outputSignalAR=function(t){var e,n=t.cells[0],i=t.cells[1],s=t.cells[2],r=t._.mul,a=t._.add;if(2===t.numChannels)for(e=n.length;e;)e-=8,i[e]=i[e]*r+a,s[e]=s[e]*r+a,i[e+1]=i[e+1]*r+a,s[e+1]=s[e+1]*r+a,i[e+2]=i[e+2]*r+a,s[e+2]=s[e+2]*r+a,i[e+3]=i[e+3]*r+a,s[e+3]=s[e+3]*r+a,i[e+4]=i[e+4]*r+a,s[e+4]=s[e+4]*r+a,i[e+5]=i[e+5]*r+a,s[e+5]=s[e+5]*r+a,i[e+6]=i[e+6]*r+a,s[e+6]=s[e+6]*r+a,i[e+7]=i[e+7]*r+a,s[e+7]=s[e+7]*r+a,n[e]=.5*(i[e]+s[e]),n[e+1]=.5*(i[e+1]+s[e+1]),n[e+2]=.5*(i[e+2]+s[e+2]),n[e+3]=.5*(i[e+3]+s[e+3]),n[e+4]=.5*(i[e+4]+s[e+4]),n[e+5]=.5*(i[e+5]+s[e+5]),n[e+6]=.5*(i[e+6]+s[e+6]),n[e+7]=.5*(i[e+7]+s[e+7]);else if(1!==r||0!==a)for(e=n.length;e;)e-=8,n[e]=n[e]*r+a,n[e+1]=n[e+1]*r+a,n[e+2]=n[e+2]*r+a,n[e+3]=n[e+3]*r+a,n[e+4]=n[e+4]*r+a,n[e+5]=n[e+5]*r+a,n[e+6]=n[e+6]*r+a,n[e+7]=n[e+7]*r+a},b.outputSignalKR=function(t){var e,n=t.cells[0],i=t.cells[1],s=t.cells[2],r=t._.mul,a=t._.add,o=n[0]*r+a;if(2===t.numChannels)for(e=n.length;e;)e-=8,n[e]=n[e+1]=n[e+2]=n[e+3]=n[e+4]=n[e+5]=n[e+6]=n[e+7]=i[e]=i[e+1]=i[e+2]=i[e+3]=i[e+4]=i[e+5]=i[e+6]=i[e+7]=s[e]=s[e+1]=s[e+2]=s[e+3]=s[e+4]=s[e+5]=s[e+6]=s[e+7]=o;else for(e=n.length;e;)e-=8,n[e]=n[e+1]=n[e+2]=n[e+3]=n[e+4]=n[e+5]=n[e+6]=n[e+7]=o},b.buddies_start=function(t){var e,n,i,s=t._.buddies;for(n=0,i=s.length;i>n;++n)switch(e=s[n],e.nodeType){case T.DSP:e.play();break;case T.TIMER:e.start();break;case T.LISTENER:e.listen()}},b.buddies_stop=function(t){var e,n,i,s=t._.buddies;for(n=0,i=s.length;i>n;++n)switch(e=s[n],e.nodeType){case T.DSP:e.pause();break;case T.TIMER:e.stop();break;case T.LISTENER:e.unlisten()}},b.fix_iOS6_1_problem=function(t){h.fix_iOS6_1_problem(t)};var k=n.modules={},S=k.EventEmitter=function(){function e(t){this.context=t,this.events={}}var n=e.prototype;return n.emit=function(e){var n=this.events[e];if(!n)return!1;var s;if("function"==typeof n){switch(arguments.length){case 1:n.call(this.context);break;case 2:n.call(this.context,arguments[1]);break;case 3:n.call(this.context,arguments[1],arguments[2]);break;default:s=i.call(arguments,1),n.apply(this.context,s)}return!0}if(w(n)){s=i.call(arguments,1);for(var r=n.slice(),a=0,o=r.length;o>a;++a)r[a]instanceof T?r[a].bang.apply(r[a],s):r[a].apply(this.context,s);return!0}return n instanceof T?(s=i.call(arguments,1),n.bang.apply(n,s),t):!1},n.on=function(t,e){if("function"!=typeof e&&!(e instanceof T))throw Error("addListener takes instances of Function or timbre.Object");var n=this.events;return n[t]?w(n[t])?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},n.once=function(t,e){var n,i=this;if("function"==typeof e)n=function(){i.off(t,n),e.apply(i.context,arguments)};else{if(!(e instanceof T))throw Error("once takes instances of Function or timbre.Object");n=function(){i.off(t,n),e.bang.apply(e,arguments)}}return n.listener=e,i.on(t,n),this},n.off=function(t,e){if("function"!=typeof e&&!(e instanceof T))throw Error("removeListener takes instances of Function or timbre.Object");var n=this.events;if(!n[t])return this;var i=n[t];if(w(i)){for(var s=-1,r=0,a=i.length;a>r;++r)if(i[r]===e||i[r].listener&&i[r].listener===e){s=r;break}if(0>s)return this;i.splice(s,1),0===i.length&&(n[t]=null)}else(i===e||i.listener&&i.listener===e)&&(n[t]=null);return this},n.removeAllListeners=function(t){var e=this.events,n=!1,i=e[t];if(w(i))for(var s=i.length;s--;){var r=i[s];r.unremovable?n=!0:this.off(t,r)}else i&&(i.unremovable?n=!0:this.off(t,i));return n||(e[t]=null),this},n.listeners=function(t){var e,n=this.events;if(!n[t])return[];if(n=n[t],!w(n))return n.unremovable?[]:[n];n=n.slice(),e=[];for(var i=0,s=n.length;s>i;++i)n[i].unremovable||e.push(n[i]);return e},e}(),x=k.Deferred=function(){function t(t){this.context=t||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new e(this)}function e(t){this.context=t.context,this.then=t.then,this.done=function(){return t.done.apply(t,arguments),this},this.fail=function(){return t.fail.apply(t,arguments),this},this.pipe=function(){return t.pipe.apply(t,arguments)},this.always=function(){return t.always.apply(t,arguments),this},this.promise=function(){return this},this.isResolved=function(){return t.isResolved()},this.isRejected=function(){return t.isRejected()}}var n=t.prototype,s=function(t,e,n,i){if("pending"===this._state){this._state=t;for(var s=0,r=e.length;r>s;++s)e[s].apply(n,i);this._doneList=this._failList=null}},r=function(t){return t&&"function"==typeof t.promise};return n.resolve=function(){var t=i.call(arguments,0);return s.call(this,"resolved",this._doneList,this.context||this,t),this},n.resolveWith=function(t){var e=i.call(arguments,1);return s.call(this,"resolved",this._doneList,t,e),this},n.reject=function(){var t=i.call(arguments,0);return s.call(this,"rejected",this._failList,this.context||this,t),this},n.rejectWith=function(t){var e=i.call(arguments,1);return s.call(this,"rejected",this._failList,t,e),this},n.promise=function(){return this._promise},n.done=function(){for(var t=i.call(arguments),e="resolved"===this._state,n="pending"===this._state,s=this._doneList,r=0,a=t.length;a>r;++r)"function"==typeof t[r]&&(e?t[r]():n&&s.push(t[r]));return this},n.fail=function(){for(var t=i.call(arguments),e="rejected"===this._state,n="pending"===this._state,s=this._failList,r=0,a=t.length;a>r;++r)"function"==typeof t[r]&&(e?t[r]():n&&s.push(t[r]));return this},n.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},n.then=function(t,e){return this.done(t).fail(e)},n.pipe=function(e,n){var s=this,a=new t(this.context);return this.done(function(){var t=e.apply(s.context,arguments);r(t)?t.then(function(){var e=i.call(arguments);a.resolveWith.apply(a,[t].concat(e))}):a.resolveWith(s,t)}),this.fail(function(){if("function"==typeof n){var t=n.apply(s.context,arguments);r(t)&&t.fail(function(){var e=i.call(arguments);a.rejectWith.apply(a,[t].concat(e))})}else a.reject.apply(a,arguments)}),a.promise()},n.isResolved=function(){return"resolved"===this._state},n.isRejected=function(){return"rejected"===this._state},n.state=function(){return this._state},t.when=function(e){var n=0,s=i.call(arguments),a=s.length,o=a;1!==a||r(e)||(o=0);var u=1===o?e:new t,l=function(t,e){return function(n){e[t]=arguments.length>1?i.call(arguments):n,--o||u.resolve.apply(u,e)}};if(a>1)for(var c=Array(a),h=function(){u.reject()};a>n;++n)s[n]&&r(s[n])?s[n].promise().done(l(n,c)).fail(h):(c[n]=s[n],--o);return o||u.resolve.apply(u,s),u.promise()},t}(),T=n.Object=function(){function e(t,i){this._={};var s=this._.events=new S(this);if(this._.emit=function(){return s.emit.apply(s,arguments)},A(i[0])){var a=i.shift(),o=a["in"];this.once("init",function(){this.set(a),o&&(w(o)?this.append.apply(this,o):o instanceof e&&this.append(o))})}switch(this.tickID=-1,this.nodes=i.map(n),this.cells=[],this.numChannels=t,t){case 0:this.L=this.R=new O(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new O(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new O(this),this.R=new O(this),this.cells[0]=new b.SignalArray(h.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=r,this.nodeType=e.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=h.samplerate,this._.cellsize=h.cellsize,this._.buddies=[]}e.DSP=1,e.TIMER=2,e.LISTENER=3;var s=e.prototype;return Object.defineProperties(s,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(1&this.playbackState)}},mul:{set:function(t){"number"==typeof t&&(this._.mul=t,this._.emit("setMul",t))},get:function(){return this._.mul}},add:{set:function(t){"number"==typeof t&&(this._.add=t,this._.emit("setAdd",t))},get:function(){return this._.add}},buddies:{set:function(t){w(t)||(t=[t]),this._.buddies=t.filter(function(t){return t instanceof e})},get:function(){return this._.buddies}}}),s.toString=function(){return this.constructor.name},s.valueOf=function(){return h.tickID!==this.tickID&&this.process(h.tickID),this.cells[0][0]},s.append=function(){if(arguments.length>0){var t=i.call(arguments).map(n);this.nodes=this.nodes.concat(t),this._.emit("append",t)}return this},s.appendTo=function(t){return t.append(this),this},s.remove=function(){if(arguments.length>0){for(var t,e=this.nodes,n=[],i=0,s=arguments.length;s>i;++i)-1!==(t=e.indexOf(arguments[i]))&&(n.push(e[t]),e.splice(t,1));n.length>0&&this._.emit("remove",n)}return this},s.removeFrom=function(t){return t.remove(this),this},s.removeAll=function(){var t=this.nodes.slice();return this.nodes=[],t.length>0&&this._.emit("remove",t),this},s.removeAtIndex=function(t){var e=this.nodes[t];return e&&(this.nodes.splice(t,1),this._.emit("remove",[e])),this},s.postMessage=function(t){return this._.emit("message",t),this},s.to=function(t){if(t instanceof e)t.append(this);else{var n=i.call(arguments);A(n[1])?n.splice(2,0,this):n.splice(1,0,this),t=_.apply(null,n)}return t},s.splice=function(t,n,i){var s;return n?n instanceof e&&(s=n.nodes.indexOf(i),-1!==s&&n.nodes.splice(s,1),t instanceof e?(t.nodes.push(this),n.nodes.push(t)):n.nodes.push(this)):this._.dac&&(t instanceof e?i instanceof e?i._.dac&&(i._.dac._.node=t,t._.dac=i._.dac,i._.dac=null,t.nodes.push(this)):this._.dac&&(this._.dac._.node=t,t._.dac=this._.dac,this._.dac=null,t.nodes.push(this)):i instanceof e&&i._.dac&&(i._.dac._.node=this,this._.dac=i._.dac,i._.dac=null)),this},s.on=s.addListener=function(t,e){return this._.events.on(t,e),this},s.once=function(t,e){return this._.events.once(t,e),this},s.off=s.removeListener=function(t,e){return this._.events.off(t,e),this},s.removeAllListeners=function(t){return this._.events.removeAllListeners(t),this},s.listeners=function(t){return this._.events.listeners(t)},s.set=function(t,e){var n,i,s=this._.meta;switch(typeof t){case"string":switch(s[t]){case"property":this[t]=e;break;case"function":this[t](e);break;default:for(n=this;null!==n;)i=Object.getOwnPropertyDescriptor(n,t),i&&("function"==typeof i.value?(s[t]="function",this[t](e)):(i.get||i.set)&&(s[t]="property",this[t]=e)),n=Object.getPrototypeOf(n)}break;case"object":for(n in t)this.set(n,t[n])}return this},s.get=function(e){return"property"===this._.meta[e]?this[e]:t},s.bang=function(){return this._.emit.apply(this,["bang"].concat(i.call(arguments))),this},s.process=b.nop,s.bypass=function(){return this._.bypassed=0===arguments.length?!0:!!arguments[0],this},s.play=function(){var t=this._.dac;return null===t&&(t=this._.dac=new F(this)),t.play()&&this._.emit.apply(this,["play"].concat(i.call(arguments))),b.buddies_start(this),this},s.pause=function(){var t=this._.dac;return t&&t.playbackState===r&&(t.pause(),this._.dac=null,this._.emit("pause")),b.buddies_stop(this),this},s.start=s.stop=s.listen=s.unlisten=function(){return this},s.ar=function(){return(0===arguments.length?0:!arguments[0])?this.kr(!0):this._.kronly||(this._.ar=!0,this._.emit("ar",!0)),this},s.kr=function(){return(0===arguments.length?0:!arguments[0])?this.ar(!0):this._.aronly||(this._.ar=!1,this._.emit("ar",!1)),this},s.plot="browser"===v?function(e){var n=this._,i=e.target;if(!i)return this;var s,r=e.width||i.width||320,a=e.height||i.height||240,o=(e.x||0)+.5,u=e.y||0,l=i.getContext("2d");s=e.foreground!==t?e.foreground:n.plotForeground||"rgb(  0, 128, 255)";var c;c=e.background!==t?e.background:n.plotBackground||"rgb(255, 255, 255)";var h,f,p,v,m,d=e.lineWidth||n.plotLineWidth||1,g=!!n.plotCyclic,_=n.plotData||this.cells[0],y=e.range||n.plotRange||[-1.2,1.2],b=y[0],w=a/(y[1]-b),A=r/_.length,k=_.length;if(l.save(),l.rect(o,u,r,a),null!==c&&(l.fillStyle=c,l.fillRect(o,u,r,a)),n.plotBefore&&n.plotBefore.call(this,l,o,u,r,a),n.plotBarStyle)for(l.fillStyle=s,h=0,m=0;k>m;++m)p=(_[m]-b)*w,f=a-p,l.fillRect(h+o,f+u,A,p),h+=A;else{for(l.strokeStyle=s,l.lineWidth=d,l.beginPath(),h=0,v=a-(_[0]-b)*w,l.moveTo(h+o,v+u),m=1;k>m;++m)h+=A,f=a-(_[m]-b)*w,l.lineTo(h+o,f+u);g?l.lineTo(h+A+o,v+u):l.lineTo(h+A+o,f+u),l.stroke()}n.plotAfter&&n.plotAfter.call(this,l,o,u,r,a);var S=e.border||n.plotBorder;return S&&(l.strokeStyle="string"==typeof S?S:"#000",l.lineWidth=1,l.strokeRect(o,u,r,a)),l.restore(),this}:b.nop,e}(),O=n.ChannelObject=function(){function t(t){n.Object.call(this,-1,[]),b.fixAR(this),this._.parent=t,this.cell=new b.SignalArray(h.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1}return b.extend(t),t.prototype.process=function(t){return this.tickID!==t&&(this.tickID=t,this._.parent&&this._.parent.process(t)),this},t}(),R=function(){function t(t){T.call(this,2,t)}return b.extend(t),t.prototype.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,e.ar?(b.inputSignalAR(this),b.outputSignalAR(this)):(this.cells[0][0]=b.inputSignalKR(this),b.outputSignalKR(this))),this},b.register("+",t),t}(),j=function(){function t(t){if(T.call(this,1,[]),b.fixKR(this),this.value=t[0],A(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}this.on("setAdd",b.changeWithValue),this.on("setMul",b.changeWithValue)}b.extend(t);var e=t.prototype;return Object.defineProperties(e,{value:{set:function(t){"number"==typeof t&&(this._.value=isNaN(t)?0:t,b.changeWithValue.call(this))},get:function(){return this._.value}}}),t}(),D=function(){function t(t){if(T.call(this,1,[]),b.fixKR(this),this.value=t[0],A(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}this.on("setAdd",b.changeWithValue),this.on("setMul",b.changeWithValue)}b.extend(t);var e=t.prototype;return Object.defineProperties(e,{value:{set:function(t){this._.value=t?1:0,b.changeWithValue.call(this)},get:function(){return!!this._.value}}}),t}(),L=function(){function t(t){if(T.call(this,1,[]),b.fixKR(this),this.func=t[0],this._.value=0,A(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}this.on("setAdd",b.changeWithValue),this.on("setMul",b.changeWithValue)}b.extend(t);var e=t.prototype;return Object.defineProperties(e,{func:{set:function(t){"function"==typeof t&&(this._.func=t)},get:function(){return this._.func}},args:{set:function(t){this._.args=w(t)?t:[t]},get:function(){return this._.args}}}),e.bang=function(){var t=this._,e=i.call(arguments).concat(t.args),n=t.func.apply(this,e);return"number"==typeof n&&(t.value=n,b.changeWithValue.call(this)),this._.emit("bang"),this},t}(),E=function(){function t(t){T.call(this,1,[]);var e,n;for(e=0,n=t[0].length;n>e;++e)this.append(t[0][e]);if(A(t[1])){var i=t[1];this.once("init",function(){this.set(i)})}}b.extend(t);var e=t.prototype;return Object.defineProperties(e,{}),e.bang=function(){var t,e,n=["bang"].concat(i.call(arguments)),s=this.nodes;for(t=0,e=s.length;e>t;++t)s[t].bang.apply(s[t],n);return this},e.postMessage=function(t){var e,n,i=this.nodes;for(e=0,n=i.length;n>e;++e)i[e].postMessage(t);return this},e.process=function(t){var e=this._;return this.tickID!==t&&(this.tickID=t,e.ar?(b.inputSignalAR(this),b.outputSignalAR(this)):(this.cells[0][0]=b.inputSignalKR(this),b.outputSignalKR(this))),this},t}(),I=function(){function t(t){if(T.call(this,1,[]),b.fixKR(this),A(t[1])){var e=t[1];this.once("init",function(){this.set(e)})}}b.extend(t);var e=t.prototype;return Object.defineProperties(e,{}),t}(),F=function(){function t(t){T.call(this,2,[]),this.playbackState=s;var i=this._;i.node=t,i.onplay=e(this),i.onpause=n(this)}b.extend(t);var e=function(t){return function(){-1===h.inlets.indexOf(t)&&(h.inlets.push(t),h.events.emit("addObject"),t.playbackState=r,t._.emit("play"))}},n=function(t){return function(){var e=h.inlets.indexOf(t);-1!==e&&(h.inlets.splice(e,1),t.playbackState=s,t._.emit("pause"),h.events.emit("removeObject"))}},i=t.prototype;return i.play=function(){return h.nextTick(this._.onplay),-1===h.inlets.indexOf(this)},i.pause=function(){h.nextTick(this._.onpause)},i.process=function(t){var e=this._.node;1&e.playbackState?(e.process(t),this.cells[1].set(e.cells[1]),this.cells[2].set(e.cells[2])):(this.cells[1].set(b.emptycell),this.cells[2].set(b.emptycell))},t}(),M=function(){function e(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=s,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=n(this),this.events=null,b.currentTimeIncr=1e3*this.cellsize/this.samplerate,b.emptycell=new b.SignalArray(this.cellsize),this.reset(!0)}var n=function(t){return function(){t.recStart=Date.now(),t.process()}},a=e.prototype;a.bind=function(t,e){if("function"==typeof t){var n=new t(this,e);this.impl=n,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},a.setup=function(e){return"object"==typeof e&&(-1!==u.indexOf(e.samplerate)&&(this.samplerate=e.samplerate<=this.impl.maxSamplerate?e.samplerate:this.impl.maxSamplerate),-1!==l.indexOf(e.cellsize)&&(this.cellsize=e.cellsize),"undefined"!=typeof Float64Array&&e.f64!==t&&(d=!!e.f64,b.SignalArray=d?Float64Array:Float32Array)),b.currentTimeIncr=1e3*this.cellsize/this.samplerate,b.emptycell=new b.SignalArray(this.cellsize),this},a.getAdjustSamples=function(t){var e,n;return t=t||this.samplerate,e=this.streammsec/1e3*t,n=Math.ceil(Math.log(e)*Math.LOG2E),n=8>n?8:n>14?14:n,1<<n},a.play=function(){return this.status===s&&(this.status=r,this.streamsize=this.getAdjustSamples(),this.strmL=new b.SignalArray(this.streamsize),this.strmR=new b.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},a.pause=function(){return this.status===r&&(this.status=s,this.impl.pause(),this.events.emit("pause")),this},a.reset=function(t){return t&&(this.events=new S(this).on("addObject",function(){this.status===s&&this.play()}).on("removeObject",function(){this.status===r&&0===this.inlets.length+this.timers.length+this.listeners.length&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},a.process=function(){var t,e,n,i,s,r,a,u,l=this.tickID,c=this.strmL,h=this.strmR,f=this.amp,p=this.streamsize,v=0,m=this.cellsize,d=this.streamsize/this.cellsize,g=this.timers,_=this.inlets,y=this.listeners,w=b.currentTimeIncr;for(i=0;p>i;++i)c[i]=h[i]=0;for(;d--;){for(++l,s=0,r=g.length;r>s;++s)1&g[s].playbackState&&g[s].process(l);for(s=0,r=_.length;r>s;++s)if(t=_[s],t.process(l),1&t.playbackState)for(e=t.cells[1],n=t.cells[2],a=0,i=v;m>a;++a,++i)c[i]+=e[a],h[i]+=n[a];for(v+=m,s=0,r=y.length;r>s;++s)1&y[s].playbackState&&y[s].process(l);for(this.currentTime+=w,u=this.nextTicks.splice(0),s=0,r=u.length;r>s;++s)u[s]()}for(i=0;p>i;++i)t=c[i]*f,-1>t?t=-1:t>1&&(t=1),c[i]=t,t=h[i]*f,-1>t?t=-1:t>1&&(t=1),h[i]=t;this.tickID=l;var A=this.currentTime;if(this.status===o){if(2===this.recCh)this.recBuffers.push(new b.SignalArray(c)),this.recBuffers.push(new b.SignalArray(h));else{var k=new b.SignalArray(c.length);for(i=0,p=k.length;p>i;++i)k[i]=.5*(c[i]+h[i]);this.recBuffers.push(k)}if(A>=this.maxDuration)this.deferred.sub.reject();else if(A>=this.recDuration)this.deferred.sub.resolve();else{var S=Date.now();S-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},a.nextTick=function(t){this.status===s?t():this.nextTicks.push(t)},a.rec=function(){b.fix_iOS6_1_problem(!0);var t=new x(this);if(this.deferred)return console.warn("rec deferred is exists??"),t.reject().promise();if(this.status!==s)return console.log("status is not none",this.status),t.reject().promise();var e=0,n=arguments,r=A(n[e])?n[e++]:{},a=n[e];if("function"!=typeof a)return console.warn("no function"),t.reject().promise();this.deferred=t,this.status=o,this.reset();var u=new _("+"),l=new x(this),h={done:function(){l.resolve.apply(l,i.call(arguments))},send:function(){u.append.apply(u,arguments)}},f=this;return l.then(c,function(){b.fix_iOS6_1_problem(!1),c.call(f,!0)}),this.deferred.sub=l,this.savedSamplerate=this.samplerate,this.samplerate=r.samplerate||this.samplerate,this.recDuration=r.recDuration||1/0,this.maxDuration=r.maxDuration||6e5,this.recCh=r.ch||1,2!==this.recCh&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new b.SignalArray(this.streamsize),this.strmR=new b.SignalArray(this.streamsize),this.inlets.push(u),a(h),setTimeout(this.delayProcess,10),t.promise()};var c=function(){this.status=s,this.reset();var t,e=this.recBuffers,n=this.samplerate,i=this.streamsize;this.samplerate=this.savedSamplerate,t=1/0!==this.recDuration?0|.001*this.recDuration*n:(e.length>>this.recCh-1)*i;var r,a,o=0|t/i,u=0,l=0,c=t;if(2===this.recCh){var h=new b.SignalArray(t),f=new b.SignalArray(t),p=new b.SignalArray(t);for(a=0;o>a;++a)if(h.set(e[u++],l),f.set(e[u++],l),l+=i,c-=i,c>0&&i>c){h.set(e[u++].subarray(0,c),l),f.set(e[u++].subarray(0,c),l);break}for(a=0,o=t;o>a;++a)p[a]=.5*(h[a]+f[a]);r={samplerate:n,channels:2,buffer:[p,h,f]}}else{var v=new b.SignalArray(t);for(a=0;o>a;++a)if(v.set(e[u++],l),l+=i,c-=i,c>0&&i>c){v.set(e[u++].subarray(0,c),l);break}r={samplerate:n,channels:1,buffer:[v]}}var m=[].concat.apply([r],arguments);this.deferred.resolve.apply(this.deferred,m),this.deferred=null};return a.on=function(t,e){this.events.on(t,e)},a.once=function(t,e){this.events.once(t,e)},a.off=function(t,e){this.events.off(t,e)},a.removeAllListeners=function(t){this.events.removeListeners(t)},a.listeners=function(t){return this.events.listeners(t)},a.fix_iOS6_1_problem=function(t){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(t)},e}(),N=null;N="undefined"!=typeof webkitAudioContext?function(t){var e,n,i=new webkitAudioContext;b._audioContext=i,this.maxSamplerate=i.sampleRate,this.defaultSamplerate=i.sampleRate,this.env="webkit";var s=navigator.userAgent;if(s.match(/linux/i)?t.streammsec*=8:s.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(t.streammsec*=4),this.play=function(){var s,r,a,o=t.getAdjustSamples(i.sampleRate),u=t.streamsize;t.samplerate===i.sampleRate?s=function(e){var n=e.outputBuffer;t.process(),n.getChannelData(0).set(t.strmL),n.getChannelData(1).set(t.strmR)}:2*t.samplerate===i.sampleRate?s=function(e){var n,i,s=t.strmL,r=t.strmR,a=e.outputBuffer,o=a.getChannelData(0),u=a.getChannelData(1),l=a.length;for(t.process(),n=i=0;l>n;n+=2,++i)o[n]=o[n+1]=s[i],u[n]=u[n+1]=r[i]}:(r=u,a=t.samplerate/i.sampleRate,s=function(e){var n,i=t.strmL,s=t.strmR,o=e.outputBuffer,l=o.getChannelData(0),c=o.getChannelData(1),h=o.length;for(n=0;h>n;++n)r>=u&&(t.process(),r-=u),l[n]=i[0|r],c[n]=s[0|r],r+=a}),e=i.createBufferSource(),n=i.createJavaScriptNode(o,2,t.channels),n.onaudioprocess=s,e.noteOn(0),e.connect(n),n.connect(i.destination)},this.pause=function(){e.disconnect(),n.disconnect()},m){var r=0,a=i.createBufferSource();this.fix_iOS6_1_problem=function(t){r+=t?1:-1,1===r?(a.noteOn(0),a.connect(i.destination)):0===r&&a.disconnect()}}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(t){var e=function(){var t="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",e=new Blob([t],{type:"text/javascript"}),n=URL.createObjectURL(e);return new Worker(n)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var n=new Audio,i=new Float32Array(t.streamsize*t.channels),s=t.streammsec,r=0,a=1e3*(t.streamsize/t.samplerate),o=Date.now(),u=function(){if(!(r>Date.now()-o)){var e=t.strmL,s=t.strmR,u=i.length,l=e.length;
for(t.process();l--;)i[--u]=s[l],i[--u]=e[l];n.mozWriteAudio(i),r+=a}};n.mozSetup(t.channels,t.samplerate),e.onmessage=u,e.postMessage(s)},this.pause=function(){e.postMessage(0)}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},h=(new M).bind(N);var C=n;"node"===v?module.exports=global.timbre=C:"browser"===v&&(C.noConflict=function(){var t=window.timbre,e=window.T;return function(n){return window.T===C&&(window.T=e),n&&window.timbre===C&&(window.timbre=t),C}}(),window.timbre=window.T=C),function(){function t(t){try{return e.plugins&&e.mimeTypes&&e.mimeTypes.length?e.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[t]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[t]}catch(n){return-1}}if("nop"===h.impl.env&&"browser"===v&&!m){var e=navigator;if(!(10>t(0))){var n,i="TimbreFlashPlayerDiv",s=function(){var t=document.getElementsByTagName("script");if(t&&t.length)for(var e,n=0,i=t.length;i>n;++n)if(e=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(t[n].src))return e[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function t(t){var e=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var i,r=Array(t.streamsize*t.channels),a=t.streammsec,o=0,u=1e3*(t.streamsize/t.samplerate),l=Date.now();i=function(){if(!(o>Date.now()-l)){var e=t.strmL,i=t.strmR,s=r.length,a=e.length;for(t.process();a--;)r[--s]=0|32768*i[a],r[--s]=0|32768*e[a];n.writeAudio(r.join(" ")),o+=u}},n.setup?(n.setup(t.channels,t.samplerate),e=setInterval(i,a)):console.warn("Cannot find "+s)},this.pause=function(){0!==e&&(n.cancel(),clearInterval(e),e=0)}}h.bind(t),delete window.timbrejs_flashfallback_init};var r,a,o=s,u=o+"?"+ +new Date,l="TimbreFlashPlayer",c=document.createElement("div");c.id=i,c.style.display="inline",c.width=c.height=1,e.plugins&&e.mimeTypes&&e.mimeTypes.length?(r=document.createElement("object"),r.id=l,r.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",r.width=r.height=1,r.setAttribute("data",u),r.setAttribute("type","application/x-shockwave-flash"),a=document.createElement("param"),a.setAttribute("name","allowScriptAccess"),a.setAttribute("value","always"),r.appendChild(a),c.appendChild(r)):c.innerHTML='<object id="'+l+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+u+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(c),n=document[l]})}}}()})(),function(t){"use strict";function e(t){this.samplerate=t||44100,this.value=i,this.status=f,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new n(t),this._table=[],this._initValue=i,this._curveValue=0,this._defaultCurveType=r,this._index=0,this._counter=0}function n(t){this.samplerate=t,this.value=i,this.step=1,this._curveType=r,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var i=e.ZERO=1e-6,s=e.CurveTypeSet=0,r=e.CurveTypeLin=1,a=e.CurveTypeExp=2,o=e.CurveTypeSin=3,u=e.CurveTypeWel=4,l=e.CurveTypeCurve=5,c=e.CurveTypeSqr=6,h=e.CurveTypeCub=7,f=e.StatusWait=0,p=e.StatusGate=1,v=e.StatusSustain=2,m=e.StatusRelease=3,d=e.StatusEnd=4,g={set:s,lin:r,linear:r,exp:a,exponential:a,sin:o,sine:o,wel:u,welch:u,sqr:c,squared:c,cub:h,cubed:h};e.CurveTypeDict=g;var _=e.prototype;_.clone=function(){var t=new e(this.samplerate);return t._table=this._table,t._initValue=this._initValue,t.setCurve(this.curve),null!==this.releaseNode&&t.setReleaseNode(this.releaseNode+1),null!==this.loopNode&&t.setLoopNode(this.loopNode+1),t.setStep(this.step),t.reset(),t},_.setTable=function(t){this._initValue=t[0],this._table=t.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=f},_.setCurve=function(t){"number"==typeof t?(this._defaultCurveType=l,this._curveValue=t,this.curve=t):(this._defaultCurveType=g[t]||null,this.curve=t)},_.setReleaseNode=function(t){"number"==typeof t&&t>0&&(this.releaseNode=t-1)},_.setLoopNode=function(t){"number"==typeof t&&t>0&&(this.loopNode=t-1)},_.setStep=function(t){this.step=this._envValue.step=t},_.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=f},_.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=m)},_.getInfo=function(t){var e,n,i=this._table,s=0,r=1/0,a=1/0,o=!1;for(e=0,n=i.length;n>e;++e){this.loopNode===e&&(r=s),this.releaseNode===e&&(t>s?s+=t:s=t,a=s);var u=i[e];Array.isArray(u)&&(s+=u[1])}return 1/0!==r&&1/0===a&&(s+=t,o=!0),{totalDuration:s,loopBeginTime:r,releaseBeginTime:a,isEndlessLoop:o}},_.calcStatus=function(){var t,e,n,i,a=this.status,o=this._table,u=this._index,c=this._counter,h=this._curveValue,g=this._defaultCurveType,_=this.loopNode,y=this.releaseNode,b=this._envValue,w=null;switch(a){case f:case d:break;case p:case m:for(;0>=c;)if(u>=o.length){if(a===p&&null!==_){u=_;continue}a=d,c=1/0,i=s,w="ended"}else if(a!==p||u!==y)t=o[u++],e=t[0],i=null===t[2]?g:t[2],i===l&&(h=t[3],.001>Math.abs(h)&&(i=r)),n=t[1],c=b.setNext(e,n,i,h);else{if(null!==_&&y>_){u=_;continue}a=v,c=1/0,i=s,w="sustained"}}return this.status=a,this.emit=w,this._index=u,this._counter=c,a},_.next=function(){return 1&this.calcStatus()&&(this.value=this._envValue.next()||i),this._counter-=1,this.value},_.process=function(t){var e,n=this._envValue,s=t.length;if(1&this.calcStatus())for(e=0;s>e;++e)t[e]=n.next()||i;else{var r=this.value||i;for(e=0;s>e;++e)t[e]=r}this.value=t[s-1],this._counter-=t.length},n.prototype.setNext=function(t,e,n,i){var f,p,v,m,d,g,_,b=this.step,w=this.value,A=0|.001*e*this.samplerate/b;switch(1>A&&(A=1,n=s),n){case s:this.value=t;break;case r:f=(t-w)/A;break;case a:f=0!==w?Math.pow(t/w,1/A):0;break;case o:p=Math.PI/A,m=.5*(t+w),d=2*Math.cos(p),g=.5*(t-w),_=g*Math.sin(.5*Math.PI-p),w=m-g;break;case u:p=.5*Math.PI/A,d=2*Math.cos(p),t>=w?(m=w,g=0,_=-Math.sin(p)*(t-w)):(m=t,g=w-t,_=Math.cos(p)*(w-t)),w=m+g;break;case l:v=(t-w)/(1-Math.exp(i)),m=w+v,d=v,f=Math.exp(i/A);break;case c:g=Math.sqrt(w),_=Math.sqrt(t),f=(_-g)/A;break;case h:g=Math.pow(w,.33333333),_=Math.pow(t,.33333333),f=(_-g)/A}return this.next=y[n],this._grow=f,this._a2=m,this._b1=d,this._y1=g,this._y2=_,A};var y=[];y[s]=function(){return this.value},y[r]=function(){return this.value+=this._grow,this.value},y[a]=function(){return this.value*=this._grow,this.value},y[o]=function(){var t=this._b1*this._y1-this._y2;return this.value=this._a2-t,this._y2=this._y1,this._y1=t,this.value},y[u]=function(){var t=this._b1*this._y1-this._y2;return this.value=this._a2+t,this._y2=this._y1,this._y1=t,this.value},y[l]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},y[c]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},y[h]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},n.prototype.next=y[s],t.modules.Envelope=e,t.modules.EnvelopeValue=n}(timbre),function(t){"use strict";function e(t){this.samplerate=t||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=r/this.samplerate,this._radtoinc=r/(2*Math.PI)}function n(t,e,n,i){var s,r,a,o,u,l=c[e];if(void 0!==l){switch("function"==typeof l&&(l=l()),n){case"@1":for(r=512;1024>r;++r)l[r]=0;break;case"@2":for(r=512;1024>r;++r)l[r]=Math.abs(l[r]);break;case"@3":for(r=256;512>r;++r)l[r]=0;for(r=512;768>r;++r)l[r]=Math.abs(l[r]);for(r=768;1024>r;++r)l[r]=0;break;case"@4":for(s=new Float32Array(1024),r=0;512>r;++r)s[r]=l[r<<1];l=s;break;case"@5":for(s=new Float32Array(1024),r=0;512>r;++r)s[r]=Math.abs(l[r<<1]);l=s}if(void 0!==i&&50!==i){for(i*=.01,i=0>i?0:i>1?1:i,s=new Float32Array(1024),a=0|1024*i,r=0;a>r;++r)s[r]=l[0|512*(r/a)];for(u=1024-a,o=0;1024>r;++r,++o)s[r]=l[0|512*(o/u)+512];l=s}if("+"===t)for(r=0;1024>r;++r)l[r]=.5*l[r]+.5;else if("-"===t)for(r=0;1024>r;++r)l[r]*=-1;return l}}function i(t){var e=new Float32Array(1024),n=t.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,s=0;n>i;++i){var r=parseInt(t.substr(2*i,2),16);r=128&r?(r-256)/128:r/127;for(var a=0,o=1024/n;o>a;++a)e[s++]=r}return e}function s(t){var e=new Float32Array(1024);if(8===t.length){var n,i,s=parseInt(t,16),r=new Float32Array(8);for(r[0]=1,n=0;7>n;++n)r[n+1]=.0625*(15&s),s>>=4;for(n=0;8>n;++n){var a=0,o=(n+1)/1024;for(i=0;1024>i;++i)e[i]+=Math.sin(2*Math.PI*a)*r[n],a+=o}var u,l=0;for(n=0;1024>n;++n)(u=Math.abs(e[n]))>l&&(l=u);if(l>0)for(n=0;1024>n;++n)e[n]/=l}return e}var r=1024,a=r-1,o=e.prototype;o.setWave=function(e){var n,i,s=this.wave;if(this.wave||(this.wave=new Float32Array(r+1)),"function"==typeof e)for(n=0;r>n;++n)s[n]=e(n/r);else if(t.fn.isSignalArray(e))if(e.length===s.length)s.set(e);else for(i=e.length/r,n=0;r>n;++n)s[n]=e[0|n*i];else"string"==typeof e&&void 0!==(i=u(e))&&this.wave.set(i);this.wave[r]=this.wave[0]},o.clone=function(){var t=new e(this.samplerate);return t.wave=this.wave,t.step=this.step,t.frequency=this.frequency,t.value=this.value,t.phase=this.phase,t.feedback=this.feedback,t},o.reset=function(){this._x=0},o.next=function(){var t=this._x,e=0|t+this.phase*this._radtoinc;return this.value=this.wave[e&a],t+=this.frequency*this._coeff*this.step,t>r&&(t-=r),this._x=t,this.value},o.process=function(t){var e,n,i,s,o,u,l=this.wave,c=this._radtoinc,h=this._x,f=this.frequency*this._coeff,p=this.step;if(this.feedback){var v=this._lastouts;for(c*=this.phase,u=0;p>u;++u)e=h+v*c,n=0|e,i=e-n,n&=a,s=l[n],o=l[n+1],t[u]=v=s+i*(o-s),h+=f;this._lastouts=v}else{var m=this.phase*c;for(u=0;p>u;++u)e=h+m,n=0|e,i=e-n,n&=a,s=l[n],o=l[n+1],t[u]=s+i*(o-s),h+=f}h>r&&(h-=r),this._x=h,this.value=t[t.length-1]},o.processWithFreqArray=function(t,e){var n,i,s,o,u,l,c=this.wave,h=this._radtoinc,f=this._x,p=this._coeff,v=this.step;if(this.feedback){var m=this._lastouts;for(h*=this.phase,l=0;v>l;++l)n=f+m*h,i=0|n,s=n-i,i&=a,o=c[i],u=c[i+1],t[l]=m=o+s*(u-o),f+=e[l]*p;this._lastouts=m}else{var d=this.phase*this._radtoinc;for(l=0;v>l;++l)n=f+d,i=0|n,s=n-i,i&=a,o=c[i],u=c[i+1],t[l]=o+s*(u-o),f+=e[l]*p}f>r&&(f-=r),this._x=f,this.value=t[t.length-1]},o.processWithPhaseArray=function(t,e){var n,i,s,o,u,l,c=this.wave,h=this._radtoinc,f=this._x,p=this.frequency*this._coeff,v=this.step;if(this.feedback){var m=this._lastouts;for(h*=this.phase,l=0;v>l;++l)n=f+m*h,i=0|n,s=n-i,i&=a,o=c[i],u=c[i+1],t[l]=m=o+s*(u-o),f+=p;this._lastouts=m}else for(l=0;v>l;++l)n=f+e[l]*h,i=0|n,s=n-i,i&=a,o=c[i],u=c[i+1],t[l]=o+s*(u-o),f+=p;f>r&&(f-=r),this._x=f,this.value=t[t.length-1]},o.processWithFreqAndPhaseArray=function(t,e,n){var i,s,o,u,l,c,h=this.wave,f=this._radtoinc,p=this._x,v=this._coeff,m=this.step;if(this.feedback){var d=this._lastouts;for(f*=this.phase,c=0;m>c;++c)i=p+d*f,s=0|i,o=i-s,s&=a,u=h[s],l=h[s+1],t[c]=d=u+o*(l-u),p+=e[c]*v;this._lastouts=d}else for(c=0;m>c;++c)i=p+n[c]*r,s=0|i,o=i-s,s&=a,u=h[s],l=h[s+1],t[c]=u+o*(l-u),p+=e[c]*v;p>r&&(p-=r),this._x=p,this.value=t[t.length-1]};var u=function(t){var e=c[t];if(void 0!==e)return"function"==typeof e&&(e=e()),e;var r;if(r=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(t),null!==r){var a=r[1],o=r[2],u=r[3],l=r[4];if(e=n(a,o,u,l),void 0!==e)return c[t]=e,e}return r=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(t),null!==r?i(r[1]):(r=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(t),null!==r?s(r[1]):void 0)};e.getWavetable=u;var l=function(e,n){var i,s,r=new Float32Array(1024);if("function"==typeof n)for(s=0;1024>s;++s)r[s]=n(s/1024);else if(t.fn.isSignalArray(n))if(n.length===r.length)r.set(n);else for(i=n.length/1024,s=0;1024>s;++s)r[s]=n[0|s*i];c[e]=r};e.setWavetable=l;var c={sin:function(){for(var t=new Float32Array(1024),e=0;1024>e;++e)t[e]=Math.sin(2*Math.PI*(e/1024));return t},cos:function(){for(var t=new Float32Array(1024),e=0;1024>e;++e)t[e]=Math.cos(2*Math.PI*(e/1024));return t},pulse:function(){for(var t=new Float32Array(1024),e=0;1024>e;++e)t[e]=512>e?1:-1;return t},tri:function(){for(var t,e=new Float32Array(1024),n=0;1024>n;++n)t=n/1024-.25,e[n]=1-4*Math.abs(Math.round(t)-t);return e},saw:function(){for(var t,e=new Float32Array(1024),n=0;1024>n;++n)t=n/1024,e[n]=2*(t-Math.round(t));return e},fami:function(){for(var t=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],e=new Float32Array(1024),n=0;1024>n;++n)e[n]=t[0|n/1024*t.length];return e},konami:function(){for(var t=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],e=new Float32Array(1024),n=0;1024>n;++n)e[n]=t[0|n/1024*t.length];return e}};t.modules.Oscillator=e}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e);var n=this._;n.env=new r(n.samplerate),n.env.setStep(n.cellsize),n.tmp=new i.SignalArray(n.cellsize),n.ar=!1,n.plotFlush=!0,n.onended=u(this),this.on("ar",o)}function n(t,e,n,i,s,r){var a=n;return"number"==typeof t[i]?a=t[i]:"number"==typeof t[s]?a=t[s]:r&&("string"==typeof t[i]?a=r(t[i]):"string"==typeof t[s]&&(a=r(t[s]))),e>a&&(a=e),a}var i=t.fn,s=t.timevalue,r=t.modules.Envelope,a=i.isDictionary;i.extend(e);var o=function(t){this._.env.setStep(t?1:this._.cellsize)},u=function(t){return function(){t._.emit("ended")}},l=e.prototype;Object.defineProperties(l,{table:{set:function(t){Array.isArray(t)&&(c.call(this,t),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(t){this._.env.setCurve(t)},get:function(){return this._.env.curve}},releaseNode:{set:function(t){this._.env.setReleaseNode(t),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(t){this._.env.setLoopNode(t),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),l.clone=function(){var t=i.clone(this);return t._.env=this._.env.clone(),t},l.reset=function(){return this._.env.reset(),this},l.release=function(){var t=this._;return t.env.release(),t.emit("released"),this},l.bang=function(){var t=this._;return t.env.reset(),t.env.status=r.StatusGate,t.emit("bang"),this},l.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var n,s=this.cells[1],r=this.cells[2],a=e.cellsize;if(this.nodes.length)i.inputSignalAR(this);else for(n=0;a>n;++n)s[n]=r[n]=1;var o,u=null;if(e.ar){var l=e.tmp;for(e.env.process(l),n=0;a>n;++n)s[n]*=l[n],r[n]*=l[n];u=e.env.emit}else{for(o=e.env.next(),n=0;a>n;++n)s[n]*=o,r[n]*=o;u=e.env.emit}i.outputSignalAR(this),u&&("ended"===u?i.nextTick(e.onended):this._.emit(u,e.value))}return this};var c=function(t){for(var e,n,i,a,o=this._.env,u=[t[0]||f],l=1,c=t.length;c>l;++l)e=t[l][0]||f,n=t[l][1],i=t[l][2],"number"!=typeof n&&(n="string"==typeof n?s(n):10),10>n&&(n=10),"number"==typeof i?(a=i,i=r.CurveTypeCurve):(i=r.CurveTypeDict[i]||null,a=0),u.push([e,n,i,a]);o.setTable(u)},h=t.Object.prototype.plot;l.plot=function(t){if(this._.plotFlush){var e,n,i=this._.env.clone(),s=i.getInfo(1e3),a=s.totalDuration,o=s.loopBeginTime,u=s.releaseBeginTime,l=new Float32Array(256),c=0,f=a/l.length,p=!1,v=0|.001*a*this._.samplerate;for(v/=l.length,i.setStep(v),i.status=r.StatusGate,e=0,n=l.length;n>e;++e)l[e]=i.next(),c+=f,!p&&c>=u&&(i.release(),p=!0);this._.plotData=l,this._.plotBefore=function(t,e,n,i,s){var r,l;1/0!==o&&1/0!==u&&(r=e+i*(o/a),l=e+i*(u/a),l-=r,t.fillStyle="rgba(224, 224, 224, 0.8)",t.fillRect(r,0,l,s)),1/0!==u&&(r=e+i*(u/a),l=i-r,t.fillStyle="rgba(212, 212, 212, 0.8)",t.fillRect(r,0,l,s))};var m=1/0,d=-1/0;for(e=0;n>e;++e)m>l[e]?m=l[e]:l[e]>d&&(d=l[e]);1>d&&(d=1),this._.plotRange=[m,d],this._.plotData=l,this._.plotFlush=null}return h.call(this,t)},i.register("env",e);var f=r.ZERO;i.register("perc",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,10,"a","attackTime",s),o=n(i,10,1e3,"r","releaseTime",s),u=n(i,f,1,"lv","level");return i.table=[f,[u,r],[f,o]],new e(t)}),i.register("adsr",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,10,"a","attackTime",s),o=n(i,10,300,"d","decayTime",s),u=n(i,f,.5,"s","sustainLevel"),l=n(i,10,1e3,"r","decayTime",s),c=n(i,f,1,"lv","level");return i.table=[f,[c,r],[u,o],[f,l]],i.releaseNode=3,new e(t)}),i.register("adshr",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,10,"a","attackTime",s),o=n(i,10,300,"d","decayTime",s),u=n(i,f,.5,"s","sustainLevel"),l=n(i,10,500,"h","holdTime",s),c=n(i,10,1e3,"r","decayTime",s),h=n(i,f,1,"lv","level");return i.table=[f,[h,r],[u,o],[u,l],[f,c]],new e(t)}),i.register("asr",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,10,"a","attackTime",s),o=n(i,f,.5,"s","sustainLevel"),u=n(i,10,1e3,"r","releaseTime",s);return i.table=[f,[o,r],[f,u]],i.releaseNode=2,new e(t)}),i.register("dadsr",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,100,"dl","delayTime",s),o=n(i,10,10,"a","attackTime",s),u=n(i,10,300,"d","decayTime",s),l=n(i,f,.5,"s","sustainLevel"),c=n(i,10,1e3,"r","relaseTime",s),h=n(i,f,1,"lv","level");return i.table=[f,[f,r],[h,o],[l,u],[f,c]],i.releaseNode=4,new e(t)}),i.register("ahdsfr",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,10,"a","attackTime",s),o=n(i,10,10,"h","holdTime",s),u=n(i,10,300,"d","decayTime",s),l=n(i,f,.5,"s","sustainLevel"),c=n(i,10,5e3,"f","fadeTime",s),h=n(i,10,1e3,"r","relaseTime",s),p=n(i,f,1,"lv","level");return i.table=[f,[p,r],[p,o],[l,u],[f,c],[f,h]],i.releaseNode=5,new e(t)}),i.register("linen",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,10,"a","attackTime",s),o=n(i,10,1e3,"s","sustainTime",s),u=n(i,10,1e3,"r","releaseTime",s),l=n(i,f,1,"lv","level");return i.table=[f,[l,r],[l,o],[f,u]],new e(t)}),i.register("env.tri",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,20,1e3,"dur","duration",s),o=n(i,f,1,"lv","level");return r*=.5,i.table=[f,[o,r],[f,r]],new e(t)}),i.register("env.cutoff",function(t){a(t[0])||t.unshift({});var i=t[0],r=n(i,10,100,"r","relaseTime",s),o=n(i,f,1,"lv","level");return i.table=[o,[f,r]],new e(t)})}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e);var i=this._;i.freq=t(440),i.phase=t(0),i.osc=new s(i.samplerate),i.tmp=new n.SignalArray(i.cellsize),i.osc.step=i.cellsize,this.once("init",r)}var n=t.fn,i=t.timevalue,s=t.modules.Oscillator;n.extend(e);var r=function(){var t=this._;this.wave||(this.wave="sin"),t.plotData=t.osc.wave,t.plotLineWidth=2,t.plotCyclic=!0,t.plotBefore=o},a=e.prototype;Object.defineProperties(a,{wave:{set:function(t){this._.osc.setWave(t)},get:function(){return this._.osc.wave}},freq:{set:function(e){"string"==typeof e&&(e=i(e),e=0>=e?0:1e3/e),this._.freq=t(e)},get:function(){return this._.freq}},phase:{set:function(e){this._.phase=t(e),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(e){this._.phase=t(e),this._.osc.feedback=!0},get:function(){return this._.phase}}}),a.clone=function(){var t=n.clone(this);return t._.osc=this._.osc.clone(),t._.freq=this._.freq,t._.phase=this._.phase,t},a.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},a.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i,s=this.cells[1],r=this.cells[2],a=e.cellsize;if(this.nodes.length)n.inputSignalAR(this);else for(i=0;a>i;++i)s[i]=r[i]=1;var o=e.osc,u=e.freq.process(t).cells[0],l=e.phase.process(t).cells[0];if(o.frequency=u[0],o.phase=l[0],e.ar){var c=e.tmp;for(e.freq.isAr?e.phase.isAr?o.processWithFreqAndPhaseArray(c,u,l):o.processWithFreqArray(c,u):e.phase.isAr?o.processWithPhaseArray(c,l):o.process(c),i=0;a>i;++i)s[i]*=c[i],r[i]*=c[i]}else{var h=o.next();for(i=0;a>i;++i)s[i]*=h,r[i]*=h}n.outputSignalAR(this)}return this};var o;"browser"===t.envtype&&(o=function(t,e,n,i,s){var r=(s>>1)+.5;t.strokeStyle="#ccc",t.lineWidth=1,t.beginPath(),t.moveTo(e,r+n),t.lineTo(e+i,r+n),t.stroke()}),n.register("osc",e),n.register("sin",function(t){return new e(t).set("wave","sin")}),n.register("cos",function(t){return new e(t).set("wave","cos")}),n.register("pulse",function(t){return new e(t).set("wave","pulse")}),n.register("tri",function(t){return new e(t).set("wave","tri")}),n.register("saw",function(t){return new e(t).set("wave","saw")}),n.register("fami",function(t){return new e(t).set("wave","fami")}),n.register("konami",function(t){return new e(t).set("wave","konami")}),n.register("+sin",function(t){return new e(t).set("wave","+sin").kr()}),n.register("+pulse",function(t){return new e(t).set("wave","+pulse").kr()}),n.register("+tri",function(t){return new e(t).set("wave","+tri").kr()}),n.register("+saw",function(t){return new e(t).set("wave","+saw").kr()}),n.alias("square","pulse")}(timbre),function(t){"use strict";function e(e){t.Object.call(this,0,e),n.timer(this),n.fixKR(this);var i=this._;i.queue=[],i.currentTime=0,i.maxRemain=1e3}var n=t.fn,i=t.timevalue;n.extend(e);var s=e.prototype;Object.defineProperties(s,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(t){"number"==typeof t&&t>0&&(this._.maxRemain=t)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}}),s.sched=function(t,e,n){return"string"==typeof t&&(t=i(t)),"number"==typeof t&&this.schedAbs(this._.currentTime+t,e,n),this},s.schedAbs=function(e,n,s){if("string"==typeof e&&(e=i(e)),"number"==typeof e){var r=this._,a=r.queue;if(a.length>=r.maxRemain)return this;for(var o=a.length;o--&&!(e>a[o][0]););a.splice(o+1,0,[e,t(n),s])}return this},s.advance=function(t){return"string"==typeof t&&(t=i(t)),"number"==typeof t&&(this._.currentTime+=t),this},s.clear=function(){return this._.queue.splice(0),this},s.process=function(t){var e=this._;if(this.tickID!==t){this.tickID=t;var i=null,s=e.queue;if(s.length)for(;s[0][0]<e.currentTime;){var r=e.queue.shift();if(r[1].bang(r[2]),i="sched",0===s.length){i="empty";break}}e.currentTime+=n.currentTimeIncr,i&&e.emit(i)}return this},n.register("schedule",e),n.alias("sched","schedule")}(timbre),function(t){"use strict";function e(e){t.Object.call(this,2,e),n.fixAR(this);var i=this._;this.playbackState=n.FINISHED_STATE,i.poly=4,i.genList=[],i.genDict={},i.synthdef=null,i.remGen=r(this),i.onended=n.make_onended(this)}var n=t.fn;n.extend(e);var i=e.prototype;Object.defineProperties(i,{def:{set:function(t){"function"==typeof t&&(this._.synthdef=t)},get:function(){return this._.synthdef}},poly:{set:function(t){"number"==typeof t&&t>0&&64>=t&&(this._.poly=t)},get:function(){return this._.poly}}});var s=function(t,e){return function(){t._.remGen(e.gen)}},r=function(t){return function(e){var n=t._,i=n.genList.indexOf(e);-1!==i&&n.genList.splice(i,1),e.noteNum!==void 0&&(n.genDict[e.noteNum]=null)}},a=function(e,i,r,a){r|=0,0>=r?this.noteOff(this,e):r>127&&(r=127);var o=this._,u=o.genList,l=o.genDict,c=l[e];c&&o.remGen(c);var h={freq:i,noteNum:e,velocity:r,mul:.0078125*r};if(a)for(var f in a)h[f]=a[f];h.doneAction=s(this,h),c=o.synthdef.call(this,h),c instanceof t.Object&&(c.noteNum=e,u.push(c),l[e]=h.gen=c,this.playbackState=n.PLAYING_STATE,u.length>o.poly&&o.remGen(u[0]))},o=function(){for(var t=new Float32Array(128),e=0;128>e;++e)t[e]=440*Math.pow(2,1*(e-69)/12);return t}(),u=function(t){return t>0?12*Math.log(1*t/440)*Math.LOG2E+69:0};i.noteOn=function(t,e,n){var i=o[t]||440*Math.pow(2,(t-69)/12);return a.call(this,0|t+.5,i,e,n),this},i.noteOff=function(t){var e=this._.genDict[t];return e&&e.release&&e.release(),this},i.noteOnWithFreq=function(t,e,n){var i=u(t);return a.call(this,0|i+.5,t,e,n),this},i.noteOffWithFreq=function(t){var e=u(t);return this.noteOff(0|e+.5)},i.allNoteOff=function(){for(var t=this._.genList,e=0,n=t.length;n>e;++e)t[e].release&&t[e].release()},i.allSoundOff=function(){for(var t=this._,e=t.genList,n=t.genDict;e.length;)delete n[e.shift().noteNum]},i.synth=function(e){var i,r=this._,a=r.genList,o={};if(e)for(var u in e)o[u]=e[u];return o.doneAction=s(this,o),i=r.synthdef.call(this,o),i instanceof t.Object&&(a.push(i),o.gen=i,this.playbackState=n.PLAYING_STATE,a.length>r.poly&&r.remGen(a[0])),this},i.process=function(t){var e=this.cells[0],i=this._;if(this.tickID!==t){if(this.tickID=t,this.playbackState===n.PLAYING_STATE){var s,r,a,o,u,l,c=i.genList,h=this.cells[1],f=this.cells[2],p=e.length;if(c.length)for(s=c[0],s.process(t),h.set(s.cells[1]),f.set(s.cells[2]),r=1,a=c.length;a>r;++r)for(s=c[r],s.process(t),u=s.cells[1],l=s.cells[2],o=0;p>o;++o)h[o]+=u[o],f[o]+=l[o];else n.nextTick(i.onended)}n.outputSignalAR(this)}return this},n.register("SynthDef",e);var l={set:function(e){n.isDictionary(e)?"string"==typeof e.type&&(this._.env=e):e instanceof t.Object&&(this._.env=e)},get:function(){return this._.env}};n.register("OscGen",function(){var n={set:function(e){e instanceof t.Object&&(this._.osc=e)},get:function(){return this._.osc}},i={set:function(t){"string"==typeof t&&(this._.wave=t)},get:function(){return this._.wave}},s=function(e){var n,i,s,r,a=this._;return i=a.osc||null,s=a.env||{},r=s.type||"perc",i instanceof t.Object&&"function"==typeof i.clone&&(i=i.clone()),i||(i=t("osc",{wave:a.wave})),i.freq=e.freq,i.mul=i.mul*e.velocity/128,n=i,s instanceof t.Object?"function"==typeof s.clone&&(n=s.clone().append(n)):n=t(r,s,n),n.on("ended",e.doneAction).bang(),n};return function(t){var r=new e(t);return r._.wave="sin",Object.defineProperties(r,{env:l,osc:n,wave:i}),r.def=s,r}}()),n.register("PluckGen",function(){var n=function(e){var n,i,s,r=this._;return i=r.env||{},s=i.type||"perc",n=t("pluck",{freq:e.freq,mul:e.velocity/128}).bang(),i instanceof t.Object?"function"==typeof i.clone&&(n=i.clone().append(n)):n=t(s,i,n),n.on("ended",e.doneAction).bang(),n};return function(t){var i=new e(t);return Object.defineProperties(i,{env:l}),i.def=n,i}}())}(timbre);
//@ sourceMappingURL=timbre.js.map